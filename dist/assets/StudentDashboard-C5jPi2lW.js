var At=Object.defineProperty;var It=(o,n,c)=>n in o?At(o,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[n]=c;var R=(o,n,c)=>It(o,typeof n!="symbol"?n+"":n,c);import{e as Tt,r as s,f as Ot,j as e,b as lt,a as Lt,u as Dt}from"./index-CgkMzMIO.js";import{s as Q}from"./sos.service-CposHdQ_.js";import{A as Ft,E as Bt}from"./EventTimeline-Bqezc2jJ.js";import{c as ot,r as Pt,A as $t,g as Ee}from"./AuroraMap-CVpiY_Wg.js";import{s as at}from"./supabaseClient-pBmL2Dxj.js";import"./createLucideIcon-BcP27hZ0.js";const it="presentationModeEnabled",Ut=Tt(o=>({enabled:!1,isLoading:!1,fetchStatus:async()=>{try{const n=localStorage.getItem(it);o({enabled:n==="true"})}catch(n){console.error("Failed to fetch presentation mode status:",n)}},toggle:async(n,c)=>{var h,l;o({isLoading:!0});try{localStorage.setItem(it,n?"true":"false"),o({enabled:n,isLoading:!1})}catch(d){throw o({isLoading:!1}),new Error(((l=(h=d.response)==null?void 0:h.data)==null?void 0:l.error)||"Failed to toggle presentation mode")}}}));let ct=0;function zt(o){const{rms:n,pitchVariance:c,spikeCount:h}=o,d=(n*.5+c*.3+Math.min(h/5,1)*.2)*35;return Math.min(d,35)}function Vt(o){const{accelerationMagnitude:n,jitter:c}=o,l=Math.min(n/30*.6+c/20*.4,1)*25;return Math.min(l,25)}function Zt(o){const c=new Date().getHours();let h;return c>=6&&c<20?h=.2:c>=20&&c<24?h=.6:c>=0&&c<4?h=1:h=.4,h*20}function Ht(o){let n=10;return o!=null&&o.matchedZone?o.matchedZone.type==="high"?n=20:n=12:o!=null&&o.isNormalZone&&(n=10),(o==null?void 0:o.presentationMode)===!0?20:n}function _e(o,n,c,h){const l=zt({rms:o.rms,pitchVariance:o.pitchVariance,spikeCount:o.spikeCount}),d=Vt({accelerationMagnitude:n.accelerationMagnitude,jitter:n.jitter}),m=Zt(),p=Ht(c),x=l+d+m+p;let v;return x<25?v="low":x<50?v="medium":v="high",{audio:{stress:o.stress,score:l},motion:{intensity:n.intensity,score:d},time:{riskFactor:(()=>{const N=new Date().getHours();return N>=6&&N<20?.2:N>=20&&N<24?.6:N>=0&&N<4?1:.4})(),score:m},location:{riskFactor:1,score:p},total:x,level:v}}function qt(o,n){if(o<=50)return!1;const h=Date.now();return h-ct<1e4?!1:(ct=h,!0)}class dt{constructor(){R(this,"audioContext",null);R(this,"analyser",null);R(this,"microphone",null);R(this,"stream",null);R(this,"isActive",!1);R(this,"pitchBuffer",[]);R(this,"spikeThreshold",.7);R(this,"spikeCount",0);R(this,"presentationMode",!1)}async initialize(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8,this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.microphone.connect(this.analyser),this.isActive=!0}catch(n){throw console.error("Failed to initialize audio sensor:",n),n}}setPresentationMode(n){this.presentationMode=n,this.spikeThreshold=n?.35:.7}getAudioData(){if(!this.analyser||!this.isActive)return{rms:0,pitch:0,pitchVariance:0,spikeCount:0,stress:0};const n=this.analyser.frequencyBinCount,c=new Uint8Array(n);this.analyser.getByteFrequencyData(c);let h=0;for(let f=0;f<n;f++){const L=c[f]/255;h+=L*L}const l=Math.sqrt(h/n),d=this.presentationMode?Math.min(l*2,1):l;d>this.spikeThreshold?this.spikeCount++:this.spikeCount=Math.max(0,this.spikeCount-1);let m=0,p=0;for(let f=0;f<n;f++)c[f]>p&&(p=c[f],m=f);const x=m*this.audioContext.sampleRate/(2*n);this.pitchBuffer.push(x),this.pitchBuffer.length>50&&this.pitchBuffer.shift();const v=this.calculateVariance(this.pitchBuffer),N=d*.5+v*.3+Math.min(this.spikeCount/5,1)*.2;return{rms:d,pitch:x,pitchVariance:Math.min(v,1),spikeCount:this.spikeCount,stress:N}}calculateVariance(n){if(n.length===0)return 0;const c=n.reduce((l,d)=>l+d,0)/n.length,h=n.reduce((l,d)=>l+Math.pow(d-c,2),0)/n.length;return Math.min(h/1e4,1)}stop(){this.isActive=!1,this.stream&&(this.stream.getTracks().forEach(n=>n.stop()),this.stream=null),this.microphone&&(this.microphone.disconnect(),this.microphone=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.analyser=null}}class ut{constructor(){R(this,"isActive",!1);R(this,"lastAcceleration",null);R(this,"accelerationBuffer",[])}async initialize(){if(typeof DeviceMotionEvent>"u")throw new Error("Device motion not supported");if(typeof DeviceMotionEvent.requestPermission=="function"&&await DeviceMotionEvent.requestPermission()!=="granted")throw new Error("Motion sensor permission denied");this.isActive=!0}handleMotionEvent(n){if(!this.isActive||!n.acceleration)return{acceleration:0,accelerationMagnitude:0,jitter:0,shake:0,intensity:0};const c=n.acceleration.x??0,h=n.acceleration.y??0,l=n.acceleration.z??0,d=Math.sqrt(c*c+h*h+l*l);this.accelerationBuffer.push(d),this.accelerationBuffer.length>20&&this.accelerationBuffer.shift();const m=this.calculateJitter(this.accelerationBuffer);let p=0;if(this.lastAcceleration){const v=Math.abs(c-this.lastAcceleration.x),N=Math.abs(h-this.lastAcceleration.y),f=Math.abs(l-this.lastAcceleration.z);p=(v+N+f)/3}this.lastAcceleration={x:c,y:h,z:l};const x=Math.min(d/30*.6+m/20*.4,1);return{acceleration:d,accelerationMagnitude:d,jitter:m,shake:p,intensity:x}}calculateJitter(n){if(n.length<2)return 0;let c=0;for(let h=1;h<n.length;h++)c+=Math.abs(n[h]-n[h-1]);return c/(n.length-1)}stop(){this.isActive=!1,this.lastAcceleration=null,this.accelerationBuffer=[]}isSupported(){return typeof DeviceMotionEvent<"u"}}function mt({isOpen:o,countdown:n,triggerType:c,onSendNow:h,onCancel:l}){const d=s.useRef(null),m=s.useRef(null),p=s.useRef(null),x=s.useRef(0);return s.useEffect(()=>{if(!o){d.current&&(clearInterval(d.current),d.current=null),p.current&&(p.current.pause(),p.current.currentTime=0,p.current=null),m.current&&(m.current.close().catch(()=>{}),m.current=null);return}const v=lt.assetBasePath(),N=[`${v}sos-alarm.mp3`,`${v}sos-alarm.wav`,`${v}sos-alarm.ogg`,`${v}no-test.mp3`],f=()=>{d.current&&(clearInterval(d.current),d.current=null),m.current&&(m.current.close().catch(()=>{}),m.current=null)},L=()=>{const w=()=>{const M=x.current;if(M>=N.length)return;const b=new Audio(N[M]);b.loop=!0,b.volume=.8,b.onerror=()=>{x.current+=1,w()},p.current=b,b.play().then(()=>{f()}).catch(()=>{})};x.current=0,w()},G=()=>{try{const w=m.current||new(window.AudioContext||window.webkitAudioContext);m.current=w,w.state==="suspended"&&w.resume().catch(()=>{});const M=w.createOscillator(),b=w.createGain();M.connect(b),b.connect(w.destination),M.frequency.value=800,M.type="sine",b.gain.setValueAtTime(.3,w.currentTime),b.gain.exponentialRampToValueAtTime(.01,w.currentTime+.3),M.start(w.currentTime),M.stop(w.currentTime+.3)}catch(w){console.error("Failed to play alarm:",w)}};return G(),d.current=setInterval(G,500),L(),document.body.style.animation="flash 0.5s ease-in-out infinite",()=>{d.current&&(clearInterval(d.current),d.current=null),p.current&&(p.current.pause(),p.current.currentTime=0,p.current=null),m.current&&(m.current.close().catch(()=>{}),m.current=null),document.body.style.animation=""}},[o]),o?Ot.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes flash {
          0%, 100% { background-color: rgba(239, 68, 68, 0.1); }
          50% { background-color: rgba(239, 68, 68, 0.3); }
        }
        @keyframes pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }
      `}),e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center z-[99999]",children:e.jsxs("div",{className:"glass-panel-critical rounded-2xl p-8 max-w-md w-full mx-4 pulse-critical border border-destructive/40",children:[e.jsxs("div",{className:"text-center pb-5 mb-6 border-b border-destructive/30",children:[e.jsx("div",{className:"mx-auto mb-4 h-14 w-14 rounded-2xl border border-destructive/35 bg-destructive/15 flex items-center justify-center shadow-[0_0_40px_rgba(239,68,68,0.25)]",children:e.jsx(Ft,{className:"h-7 w-7 text-danger"})}),e.jsx("h2",{className:"text-3xl font-bold text-danger mb-2",children:c==="ai"?"AUTO SOS TRIGGERED":"EMERGENCY SOS"}),e.jsx("p",{className:"text-muted-foreground",children:c==="ai"?"High risk detected! Emergency alert will be sent automatically.":"Emergency alert will be sent automatically."})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-8xl font-bold text-danger mb-4 animate-pulse",children:n}),e.jsx("p",{className:"text-muted-foreground text-lg",children:n>1?"seconds remaining":"second remaining"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:l,className:"flex-1 px-6 py-4 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-xl font-semibold text-lg transition-colors border border-border/60",children:"Cancel"}),e.jsx("button",{onClick:h,className:"flex-1 px-6 py-4 bg-danger hover:bg-red-600 text-white rounded-xl font-semibold text-lg transition-colors shadow-[0_18px_50px_rgba(0,0,0,0.6),0_0_50px_rgba(239,68,68,0.35)]",children:"Send Now"})]})]})})]}),document.body):null}function Gt({onSOSTriggered:o,triggerType:n,onCancelAuto:c,location:h}){const[l,d]=s.useState(null),[m,p]=s.useState(!1),[x,v]=s.useState("manual"),[N,f]=s.useState(null),[L,G]=s.useState({rms:0,pitch:0,pitchVariance:0,spikeCount:0,stress:0}),[w,M]=s.useState({acceleration:0,accelerationMagnitude:0,jitter:0,shake:0,intensity:0}),b=s.useRef(null),A=s.useRef(!1),B=s.useRef(!1),U=s.useRef(null),ee=s.useRef(null),te=(k="manual")=>{B.current=!1,v(k),d(10),p(!0)};s.useEffect(()=>{n==="ai"&&l===null&&!m&&te("ai")},[n]),s.useEffect(()=>((async()=>{try{const I=new dt;await I.initialize(),f(I),U.current=I;const K=new ut;if(K.isSupported()){await K.initialize(),ee.current=K;const ie=P=>{const D=K.handleMotionEvent(P);M(D)};return window.addEventListener("devicemotion",ie),()=>window.removeEventListener("devicemotion",ie)}}catch(I){console.error("Failed to initialize sensors:",I)}})(),()=>{U.current&&U.current.stop(),ee.current&&ee.current.stop()}),[]),s.useEffect(()=>{if(!N)return;const k=setInterval(()=>{const I=N.getAudioData();G(I)},200);return()=>clearInterval(k)},[N]);const re=()=>{l===null&&te("manual")},S=()=>{b.current&&clearInterval(b.current),d(null),p(!1),x==="ai"&&c&&c()},Y=s.useCallback(async()=>{if(!B.current){B.current=!0;try{const k=_e(L,w,h||void 0);await Q.createSOS({risk_score:k.total,factors:{audio:k.audio.score,motion:k.motion.score,time:k.time.score,location:k.location.score},location:h||void 0,trigger_type:x}),o&&o()}catch(k){console.error("Failed to trigger SOS:",k),B.current=!1}finally{d(null),p(!1)}}},[L,w,x,o,h]),se=()=>{b.current&&(clearInterval(b.current),b.current=null),Y()};return s.useEffect(()=>{if(l===null){b.current&&(clearInterval(b.current),b.current=null),A.current=!1;return}if(l<=0){b.current&&(clearInterval(b.current),b.current=null),A.current=!1,Y();return}return!A.current&&l>0&&(A.current=!0,b.current=setInterval(()=>{d(k=>k===null||k<=0?(A.current=!1,b.current&&(clearInterval(b.current),b.current=null),0):k-1)},1e3)),()=>{l===null&&b.current&&(clearInterval(b.current),b.current=null,A.current=!1)}},[l,Y]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("button",{onClick:re,className:`
            relative w-32 h-32 rounded-full font-bold text-xl
            transition-all duration-300
            ${m?"bg-danger hover:bg-red-600 animate-pulse":"bg-danger hover:bg-red-600"}
            text-white
            border border-danger/50
            shadow-[0_20px_60px_rgba(0,0,0,0.6),0_0_40px_rgba(239,68,68,0.35)]
            hover:shadow-[0_22px_70px_rgba(0,0,0,0.65),0_0_55px_rgba(239,68,68,0.45)]
            active:scale-[0.98]
            focus:outline-none focus:ring-4 focus:ring-danger/40
          `,children:e.jsx("span",{children:"SOS"})}),!m&&e.jsx("div",{className:"text-white text-center",children:e.jsx("p",{className:"text-sm text-slate-400",children:"Click to trigger emergency"})})]}),e.jsx(mt,{isOpen:m&&l!==null,countdown:l!==null?l:0,triggerType:x,onSendNow:se,onCancel:S})]})}function Yt(o){const{snapshot:n,audioInputs:c,motionInputs:h,location:l,time:d}=o,m=[];if(c){const x=Math.round(c.rms*100);n.audio.score>20?m.push(`Loud audio spike detected (${x} dB)`):n.audio.score>10?m.push(`Moderate audio activity (${x} dB)`):m.push(`Normal audio levels (${x} dB)`)}if(h){const x=h.accelerationMagnitude.toFixed(1);n.motion.score>15?m.push(`Sudden jerk motion (${x}g)`):n.motion.score>8?m.push(`Moderate motion detected (${x}g)`):m.push(`Normal movement (${x}g)`)}if(l!=null&&l.zoneName){const x=l.zoneName.toLowerCase().includes("high")?"high-risk":"low-risk";m.push(`Inside ${x} zone: ${l.zoneName}`)}else l!=null&&l.isNormalZone?m.push("User is outside all predefined risk zones (normal area)"):l!=null&&l.lat&&(l!=null&&l.lng)&&m.push(`Location: ${l.lat.toFixed(4)}, ${l.lng.toFixed(4)}`);if(d){const x=d.getHours();x>=0&&x<4?m.push("Night-time multiplier applied"):x>=20&&x<24?m.push("Evening-time multiplier applied"):x>=4&&x<6?m.push("Early morning multiplier applied"):m.push("Daytime multiplier applied")}const p=n.level==="high"?"High Risk":n.level==="medium"?"Medium Risk":"Low Risk";return m.push(`→ Final Score: ${n.total.toFixed(0)}/100 (${p})`),m}function rr(){var rt,st,nt;const{user:o,logout:n}=Lt(),{enabled:c,fetchStatus:h,toggle:l}=Ut(),[d,m]=s.useState([]),[p,x]=s.useState({rms:0,pitch:0,pitchVariance:0,spikeCount:0,stress:0}),[v,N]=s.useState({acceleration:0,accelerationMagnitude:0,jitter:0,shake:0,intensity:0}),[f,L]=s.useState(_e(p,v)),[G,w]=s.useState(!1),[M,b]=s.useState(""),[A,B]=s.useState(!1),[U,ee]=s.useState(null),[te,re]=s.useState(0),[S,Y]=s.useState(null),[se,k]=s.useState([]),[I,K]=s.useState([]),[ie,P]=s.useState(!1),[D,be]=s.useState([]),[W,ye]=s.useState([]),[ne,ce]=s.useState(0),[Ae,E]=s.useState(null),[F,Ie]=s.useState(!1),[ft,Te]=s.useState(!1),[Oe,Le]=s.useState(null),[De,J]=s.useState(null),[Fe,Be]=s.useState(!1),[$,z]=s.useState(null),j=s.useRef(null),T=s.useRef(!1),le=s.useRef(!1),Pe=s.useRef(()=>{}),de=s.useRef(p),ve=s.useRef(v),$e=s.useRef(f.total),Ue=s.useRef(null),V=s.useRef(null),ue=s.useRef(null),je=s.useRef(null),me=s.useRef([]),[we,ze]=s.useState(!1),[Se,Ve]=s.useState(!1),[Ze,X]=s.useState(null),[C,He]=s.useState(null),[qe,fe]=s.useState([]),[oe,Ne]=s.useState(!1),[he,ke]=s.useState(void 0),[Ce,ge]=s.useState(""),Ge=Dt();s.useEffect(()=>()=>{W.forEach(t=>URL.revokeObjectURL(t))},[W]);const Ye=()=>{W.forEach(t=>URL.revokeObjectURL(t)),be([]),ye([]),ce(0),E(null)},ht=()=>{P(!0),E(null)},Ke=()=>{P(!1),Ye()},gt=()=>{P(!1)},xt=()=>{j.current&&(clearInterval(j.current),j.current=null),T.current=!1,z(null),E(null),P(!0)},We=t=>{if(!t||t.length===0)return;E(null);const r=Array.from(t).slice(0,5),g=r.map(i=>URL.createObjectURL(i));be(r),ye(g),ce(0)},Je=t=>{E(null);const r=URL.createObjectURL(t);be(g=>[...g,t].slice(0,5)),ye(g=>[...g,r].slice(0,5)),ce(g=>Math.min(g+1,4))},pt=()=>{try{je.current=null,me.current=[],Be(!1);const t=ue.current;t&&t.getTracks().forEach(r=>r.stop()),ue.current=null,V.current&&(V.current.srcObject=null)}catch{}},Me=()=>{pt(),Te(!1),Le(null),J(null)},Xe=async t=>{var g;if(J(null),Le(t),Te(!0),!window.isSecureContext){J("Camera requires HTTPS (or localhost).");return}if(!((g=navigator.mediaDevices)==null?void 0:g.getUserMedia)){J("Camera not supported in this browser.");return}try{const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}},audio:t==="video"});ue.current=i,V.current&&(V.current.srcObject=i,V.current.play().catch(()=>{}))}catch(i){J((i==null?void 0:i.message)||"Failed to access camera.")}},bt=async()=>{const t=V.current;if(!t)return;const r=t.videoWidth||1280,g=t.videoHeight||720,i=document.createElement("canvas");i.width=r,i.height=g;const u=i.getContext("2d");u&&(u.drawImage(t,0,0,r,g),i.toBlob(a=>{if(!a)return;const y=new File([a],`photo_${Date.now()}.jpg`,{type:"image/jpeg"});Je(y),Me()},"image/jpeg",.92))},yt=()=>{const t=ue.current;if(!t||Fe)return;const g=["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm"].find(i=>{var u,a;return(a=(u=window.MediaRecorder)==null?void 0:u.isTypeSupported)==null?void 0:a.call(u,i)});try{const i=new MediaRecorder(t,g?{mimeType:g}:void 0);me.current=[],i.ondataavailable=u=>{u.data&&u.data.size>0&&me.current.push(u.data)},i.onstop=()=>{const u=new Blob(me.current,{type:i.mimeType||"video/webm"}),a=new File([u],`video_${Date.now()}.webm`,{type:u.type||"video/webm"});Je(a),Me()},je.current=i,i.start(),Be(!0)}catch(i){J((i==null?void 0:i.message)||"Failed to start recording.")}},vt=()=>{const t=je.current;if(t&&t.state!=="inactive")try{t.stop()}catch{}},jt=t=>t.replace(/[^a-zA-Z0-9._-]/g,"_"),Qe=async()=>{var t,r;if(!(o!=null&&o.id)){E("You must be logged in to send media.");return}if(D.length===0){E("Please attach a photo or video first.");return}if(!le.current){le.current=!0,Ie(!0),E(null);try{const g=lt.supabaseStorageBucket(),i=Array.from(new Set([g,"sos-attachment","sos-attachments"].filter(Boolean))),u=i[0]||"sos-attachment",a=[];for(const y of D){const O=jt(y.name||"upload"),_=`${o.id}/${Date.now()}_${O}`;let Z=u,H=_;const Re=async ae=>at.storage.from(ae).upload(H,y,{contentType:y.type||void 0,upsert:!1});let q=await Re(Z);if(q.error){const ae=((t=q.error)==null?void 0:t.message)||"";if(/bucket.*not.*found/i.test(ae)){const pe=i.find(_t=>_t!==Z);pe&&(Z=pe,q=await Re(Z))}H=`${o.id}/${Date.now()}_${Math.random().toString(16).slice(2)}_${O}`,q=await at.storage.from(Z).upload(H,y,{contentType:y.type||void 0,upsert:!1})}if(q.error){const ae=((r=q.error)==null?void 0:r.message)||"";throw/bucket.*not.*found/i.test(ae)?new Error(`Supabase Storage bucket not found. Tried: ${i.map(pe=>`"${pe}"`).join(", ")}. Set SUPABASE_STORAGE_BUCKET (VITE_SUPABASE_STORAGE_BUCKET or NEXT_PUBLIC_SUPABASE_STORAGE_BUCKET) to your existing bucket name (e.g. "sos-attachment"), then restart the frontend dev server.`):new Error(q.error.message||"Upload failed")}a.push(H)}await Q.createSOS({risk_score:f.total,factors:{audio:f.audio.score,motion:f.motion.score,time:f.time.score,location:f.location.score},location:S||void 0,trigger_type:"manual",attachments:a}),z(null),j.current&&(clearInterval(j.current),j.current=null),T.current=!1,P(!1),Ye(),xe()}catch(g){E((g==null?void 0:g.message)||"Failed to send media."),le.current=!1,z(null),j.current&&(clearInterval(j.current),j.current=null),T.current=!1,P(!0)}finally{Ie(!1)}}};Pe.current=Qe;const wt=()=>{if(!(o!=null&&o.id)){E("You must be logged in to send media.");return}if(D.length===0){E("Please attach a photo or video first.");return}le.current=!1,E(null),z(10),gt()},St=()=>{j.current&&(clearInterval(j.current),j.current=null),T.current=!1,z(null),Qe()};s.useEffect(()=>{if($===null){j.current&&(clearInterval(j.current),j.current=null),T.current=!1;return}if($<=0){j.current&&(clearInterval(j.current),j.current=null),T.current=!1,z(null),Pe.current();return}return!T.current&&$>0&&(T.current=!0,j.current=setInterval(()=>{z(t=>t===null||t<=0?(T.current=!1,j.current&&(clearInterval(j.current),j.current=null),0):t-1)},1e3)),()=>{$===null&&j.current&&(clearInterval(j.current),j.current=null,T.current=!1)}},[$]),s.useEffect(()=>{(o==null?void 0:o.role)==="security"&&Ge("/security")},[o,Ge]);const xe=s.useCallback(async()=>{try{const t=await Q.getSOSEvents({limit:7});m(t)}catch(t){console.error("Failed to load SOS history:",t)}},[]);s.useEffect(()=>{h(),xe();const t=localStorage.getItem("accessToken");return t&&ot(t),()=>{const r=Ee();r&&r.disconnect()}},[h,xe]),s.useEffect(()=>{Pt.getRiskZones().then(t=>{k(t)}).catch(()=>{k([])})},[]),s.useEffect(()=>{var i;if(!S||!Number.isFinite(S.lat)||!Number.isFinite(S.lng)||se.length===0)return;const t=et({lat:S.lat,lng:S.lng}),r=(t==null?void 0:t.id)||null,g=((i=S.matchedZone)==null?void 0:i.id)||null;r!==g&&Y({lat:S.lat,lng:S.lng,matchedZone:t?{id:t.id,name:t.name,type:t.type}:void 0,isNormalZone:!t})},[se]);const Nt=(t,r)=>{const g=t.lng,i=t.lat;let u=!1;for(let a=0,y=r.length-1;a<r.length;y=a++){const O=r[a][0],_=r[a][1],Z=r[y][0],H=r[y][1];_>i!=H>i&&g<(Z-O)*(i-_)/(H-_)+O&&(u=!u)}return u},et=t=>{const r=se.filter(i=>{var a,y;const u=(y=(a=i==null?void 0:i.polygon)==null?void 0:a.coordinates)==null?void 0:y[0];return!u||u.length<3?!1:Nt(t,u)});return r.find(i=>i.type==="high")||r[0]||null},kt=t=>{const r=et(t);Y({...t,matchedZone:r?{id:r.id,name:r.name,type:r.type}:void 0,isNormalZone:!r})};s.useEffect(()=>{de.current=p},[p]),s.useEffect(()=>{ve.current=v},[v]),s.useEffect(()=>{$e.current=f.total},[f.total]),s.useEffect(()=>{if(!(o!=null&&o.id))return;const t=setInterval(()=>{const r=Ee();!r||!r.connected||r.emit("live_feed",{userId:o.id,audio:{rms:de.current.rms,pitch:de.current.pitch,stress:de.current.stress},motion:{acceleration:ve.current.acceleration,shake:ve.current.shake},totalRisk:$e.current})},500);return()=>{clearInterval(t)}},[o==null?void 0:o.id]),s.useEffect(()=>{if(!we||!C)return;const t=localStorage.getItem("accessToken");if(!t)return;const r=ot(t);r.emit("join_sos",C),r.emit("join_sos_chat",C);const g=a=>{!a||a.sos_id!==C||fe(y=>y.some(O=>O.id===a.id)?y:[...y,a])},i=a=>{!a||a.sosId!==C||X(a.error||"Failed to send message")},u=async a=>{var y,O;if(!(!a||String(a.id)!==String(C))&&(a.status==="resolved"&&Ne(!0),a.status==="acknowledged"&&!he))try{const _=await Q.getSOSChatById(C);ke(((y=_==null?void 0:_.chat)==null?void 0:y.security_name)||((O=_==null?void 0:_.chat)==null?void 0:O.security_email))}catch{}};return r.on("chat:message",g),r.on("chat:error",i),r.on("sos-updated",u),r.on("sos_status_update",u),()=>{r.off("chat:message",g),r.off("chat:error",i),r.off("sos-updated",u),r.off("sos_status_update",u),r.emit("leave_sos",C),r.emit("leave_sos_chat",C)}},[we,C,he]),s.useEffect(()=>{(async()=>{try{const r=new dt;await r.initialize(),r.setPresentationMode(!1),ee(r);const g=new ut;if(g.isSupported()){await g.initialize();const i=a=>{const y=g.handleMotionEvent(a);N(y)};window.addEventListener("devicemotion",i);const u=setInterval(()=>{const a=r.getAudioData();x(a)},200);return()=>{r.stop(),g.stop(),window.removeEventListener("devicemotion",i),clearInterval(u)}}else r.stop()}catch(r){console.error("Failed to initialize sensors:",r)}})()},[]),s.useEffect(()=>{U&&U.setPresentationMode(c)},[c,U]),s.useEffect(()=>{var r;const t=_e(p,v,{...S||{},presentationMode:c});L(t),K(Yt({snapshot:t,audioInputs:{rms:p.rms,pitchVariance:p.pitchVariance,spikeCount:p.spikeCount},motionInputs:{accelerationMagnitude:v.accelerationMagnitude,jitter:v.jitter},location:S?{lat:S.lat,lng:S.lng,zoneName:(r=S.matchedZone)==null?void 0:r.name,isNormalZone:S.isNormalZone}:void 0,time:new Date}))},[p,v,S,c]),s.useEffect(()=>{if(!f||!f.total||A)return;const t=Date.now();t-te<1e4||f.level==="high"&&qt(f.total)&&(B(!0),re(t))},[f,c,A,te]);const Ct=async()=>{var t,r,g,i,u;ze(!0),Ve(!0),X(null),fe([]),He(null),Ne(!1),ke(void 0);try{const a=await Q.getRecentSOSChat(),y=String(((t=a==null?void 0:a.sos)==null?void 0:t.id)||"");He(y||null),fe(Array.isArray(a==null?void 0:a.messages)?a.messages:[]),Ne(!!(a!=null&&a.read_only)),ke(((r=a==null?void 0:a.chat)==null?void 0:r.security_name)||((g=a==null?void 0:a.chat)==null?void 0:g.security_email))}catch(a){const y=((u=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:u.error)||(a==null?void 0:a.message)||"Failed to load chat";X(y)}finally{Ve(!1)}},Mt=()=>{ze(!1),X(null),ge("")},tt=async()=>{var g,i;if(!C)return;const t=Ce.trim();if(!t||oe)return;X(null);const r=Ee();if(r&&r.connected){r.emit("chat:send",{sosId:C,message:t}),ge("");return}try{const u=await Q.sendSOSChatMessage(C,t);fe(a=>a.some(y=>y.id===u.id)?a:[...a,u]),ge("")}catch(u){const a=((i=(g=u==null?void 0:u.response)==null?void 0:g.data)==null?void 0:i.error)||(u==null?void 0:u.message)||"Failed to send message";X(a)}},Rt=async()=>{try{await l(!c,M),w(!1),b("")}catch(t){alert(t.message)}},Et=[{name:"Audio",value:f.audio.score,max:35,color:f.audio.score>20?"danger":"safe"},{name:"Motion",value:f.motion.score,max:25,color:f.motion.score>15?"danger":"safe"},{name:"Time",value:f.time.score,max:20,color:f.time.score>12?"warning":"safe"},{name:"Location",value:f.location.score,max:20,color:f.location.score>15?"warning":"safe"},{name:"Total",value:f.total,max:100,color:f.level==="high"?"danger":f.level==="medium"?"warning":"safe"}];return e.jsxs("div",{className:"min-h-screen bg-black p-6 relative",children:[e.jsx("div",{className:"aurora-bg"}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 relative z-10",children:[e.jsxs("div",{className:"glass-panel px-6 py-4 flex justify-between items-center border border-border/60",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold aurora-text",children:"Student Dashboard"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Welcome, ",(o==null?void 0:o.name)||(o==null?void 0:o.email)]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"⚙️ Settings"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"Logout"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 glass-panel-critical p-6 flex flex-col items-center justify-center border border-destructive/40",children:[e.jsx("div",{className:"w-full pb-3 mb-4 border-b border-destructive/30",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground text-center",children:"Emergency SOS"})}),e.jsx(Gt,{location:S,onSOSTriggered:()=>{xe(),B(!1),re(Date.now())},triggerType:A?"ai":void 0,onCancelAuto:()=>{B(!1),re(Date.now())}}),e.jsx("button",{type:"button",onClick:ht,className:"mt-5 w-full px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"Send Photo / Video"})]}),e.jsxs("div",{className:"lg:col-span-2 glass-panel p-6 border border-border/60",children:[e.jsx("div",{className:"flex items-center justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Live Risk Assessment"})}),e.jsxs("div",{className:"space-y-4",children:[Et.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:t.name}),e.jsxs("span",{className:`font-semibold ${t.color==="danger"?"text-danger":t.color==="warning"?"text-warning":"text-safe"}`,children:[t.value.toFixed(1)," / ",t.max]})]}),e.jsx("div",{className:"w-full bg-secondary/60 rounded-full h-3 overflow-hidden border border-border/50",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${t.color==="danger"?"bg-danger shadow-[inset_0_0_14px_rgba(239,68,68,0.65)]":t.color==="warning"?"bg-warning shadow-[inset_0_0_14px_rgba(245,158,11,0.6)]":"bg-safe shadow-[inset_0_0_14px_rgba(34,197,94,0.6)]"}`,style:{width:`${t.value/t.max*100}%`}})})]},t.name)),e.jsx("div",{className:"mt-4 p-4 bg-secondary/50 border border-border/50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Risk Level"}),e.jsx("span",{className:`text-xl font-bold ${f.level==="high"?"text-danger":f.level==="medium"?"text-warning":"text-safe"}`,children:f.level.toUpperCase()})]})})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{className:"glass-panel p-6 border border-border/60",children:[e.jsx("div",{className:"flex items-center justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Live Location & Risk Zones"})}),e.jsx($t,{userLocation:S,height:"400px",onLocationUpdate:kt})]}),e.jsxs("div",{className:"glass-panel p-6 border border-border/60",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Event Timeline"}),e.jsx("button",{type:"button",onClick:Ct,disabled:d.length===0,className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Chat"})]}),d.length>0&&((rt=d[0])!=null&&rt.id)?e.jsx(Bt,{sosId:String(d[0].id),sosEvent:d[0]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No events to display"})]})]}),I.length>0&&e.jsxs("div",{className:"mt-6 glass-panel p-6 border border-border/60",children:[e.jsx("div",{className:"flex items-center justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"AI Risk Explanation"})}),e.jsx("div",{className:"space-y-2",children:I.map((t,r)=>e.jsx("div",{className:`text-muted-foreground ${t.startsWith("→")?"font-bold text-foreground text-lg mt-2":""}`,children:t},r))})]}),e.jsxs("div",{className:"mt-6 glass-panel p-6 border border-border/60",children:[e.jsx("div",{className:"flex items-center justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Last 7 Days History"})}),d.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No SOS events in the last 7 days"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border/60",children:[e.jsx("th",{className:"pb-2 text-muted-foreground",children:"Date"}),e.jsx("th",{className:"pb-2 text-muted-foreground",children:"Risk Score"}),e.jsx("th",{className:"pb-2 text-muted-foreground",children:"Trigger"}),e.jsx("th",{className:"pb-2 text-muted-foreground",children:"Status"})]})}),e.jsx("tbody",{children:d.map(t=>e.jsxs("tr",{className:"border-b border-border/40",children:[e.jsx("td",{className:"py-2 text-muted-foreground",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"py-2 text-foreground font-semibold",children:t.risk_score.toFixed(1)}),e.jsx("td",{className:"py-2 text-muted-foreground",children:t.trigger_type.charAt(0).toUpperCase()+t.trigger_type.slice(1)}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="resolved"?"bg-safe/20 text-safe":t.status==="acknowledged"?"bg-warning/20 text-warning":"bg-danger/20 text-danger"}`,children:t.status})})]},t.id))})]})})]})]}),G&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"glass-panel p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Presentation Mode"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Password"}),e.jsx("input",{type:"password",value:M,onChange:t=>b(t.target.value),className:"w-full px-4 py-2 bg-secondary/60 border border-border/50 rounded-lg text-foreground",placeholder:"Enter password"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",children:"Cancel"}),e.jsx("button",{onClick:Rt,className:"flex-1 px-4 py-2 bg-primary/80 hover:bg-primary text-primary-foreground rounded-lg border border-primary/30",children:c?"Disable":"Enable"})]})]})]})}),ie&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"glass-panel p-6 max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"Send Media"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Attach or record a photo/video, then send it to Security."})]}),e.jsx("button",{type:"button",onClick:Ke,className:"px-3 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",disabled:F,children:"Close"})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsx("button",{type:"button",className:"w-full px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",onClick:()=>{var t;return(t=Ue.current)==null?void 0:t.click()},disabled:F,children:"Attach File"}),e.jsx("button",{type:"button",className:"w-full px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",onClick:()=>Xe("photo"),disabled:F,children:"Take Photo"}),e.jsx("button",{type:"button",className:"w-full px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",onClick:()=>Xe("video"),disabled:F,children:"Record Video"}),e.jsx("input",{ref:Ue,type:"file",className:"hidden",accept:"image/*,video/*",multiple:!0,onChange:t=>We(t.target.files)}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*,video/*",multiple:!0,onChange:t=>We(t.target.files)}),D.length>0?e.jsxs("div",{className:"rounded-lg border border-border/40 bg-secondary/40 p-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Selected"}),e.jsx("div",{className:"mt-2 space-y-2",children:D.map((t,r)=>e.jsxs("button",{type:"button",className:`w-full text-left px-3 py-2 rounded-md border transition-colors ${r===ne?"bg-secondary/70 border-border/70":"bg-secondary/40 border-border/40 hover:bg-secondary/60"}`,onClick:()=>ce(r),disabled:F,children:[e.jsx("div",{className:"text-foreground text-sm truncate",children:t.name}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:[(t.size/1024/1024).toFixed(2)," MB"]})]},`${t.name}-${r}`))})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No file selected."})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsxs("div",{className:"rounded-xl border border-border/40 bg-secondary/30 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-border/40",children:e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Preview"})}),e.jsx("div",{className:"p-4",children:W[ne]?(nt=(st=D[ne])==null?void 0:st.type)!=null&&nt.startsWith("video/")?e.jsx("video",{src:W[ne],controls:!0,className:"w-full max-h-[360px] rounded-lg bg-black"}):e.jsx("img",{src:W[ne],alt:"Preview",className:"w-full max-h-[360px] object-contain rounded-lg bg-black/20"}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Select a photo or video to preview it here."})})]}),Ae?e.jsx("div",{className:"mt-4 rounded-lg border border-destructive/40 bg-destructive/15 px-4 py-3 text-sm text-destructive-foreground",children:Ae}):null,e.jsxs("div",{className:"mt-5 flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:Ke,className:"px-5 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",disabled:F,children:"Cancel"}),e.jsx("button",{type:"button",onClick:wt,className:"px-5 py-2 bg-primary/80 hover:bg-primary text-primary-foreground rounded-lg border border-primary/30 disabled:opacity-50 disabled:cursor-not-allowed",disabled:F||D.length===0,children:F?"Sending…":"Send"})]})]})]})]})}),e.jsx(mt,{isOpen:$!==null,countdown:$!==null?$:0,triggerType:"manual",onSendNow:St,onCancel:xt}),we&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"glass-panel p-6 max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 pb-3 border-b border-border/40",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"SOS Chat"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:he?`Connected to: ${he}`:"Waiting for Security to acknowledge…"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground px-2 py-1 rounded-md border border-border/40 bg-black/30",children:oe?"Read-only":"Live"}),e.jsx("button",{type:"button",onClick:Mt,className:"px-3 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",children:"Close"})]})]}),Se?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading chat…"}):Ze?e.jsx("div",{className:"mt-4 text-sm text-danger",children:Ze}):null,e.jsx("div",{className:"mt-4 rounded-lg border border-border/50 bg-black/35 h-[360px] overflow-y-auto p-4",children:qe.length===0?e.jsx("div",{className:"text-muted-foreground text-sm",children:"No messages yet."}):e.jsx("div",{className:"space-y-3",children:qe.map(t=>{const r=!!(o!=null&&o.id&&t.sender_id===o.id);return e.jsx("div",{className:r?"flex justify-end":"flex justify-start",children:e.jsxs("div",{className:r?"max-w-[85%] rounded-2xl rounded-tr-sm bg-primary/20 border border-primary/25 px-4 py-3 shadow-[0_10px_30px_rgba(0,0,0,0.35)]":"max-w-[85%] rounded-2xl rounded-tl-sm bg-secondary/35 border border-border/50 px-4 py-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r?"You":t.sender_name||t.sender_email||t.sender_id," • ",new Date(t.created_at).toLocaleString()]}),e.jsx("div",{className:"text-foreground mt-1 whitespace-pre-wrap",children:t.message})]})},t.id)})})}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("input",{value:Ce,onChange:t=>ge(t.target.value),placeholder:oe?"Chat is read-only (resolved)":"Type a message…",disabled:oe||Se||!C,className:"flex-1 px-4 py-3 rounded-xl border border-border/60 bg-black/30 text-foreground backdrop-blur-sm focus:outline-none focus:border-primary/60 disabled:opacity-60",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),tt())}}),e.jsx("button",{type:"button",onClick:tt,disabled:oe||Se||!C||!Ce.trim(),className:"px-5 py-3 bg-primary/80 hover:bg-primary text-primary-foreground rounded-xl border border-primary/30 shadow-[0_0_24px_rgba(37,246,228,0.15)] disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]})]})}),ft?e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[99998]",children:e.jsxs("div",{className:"glass-panel p-5 max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:Oe==="video"?"Record Video":"Take Photo"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Allow camera permission when prompted."})]}),e.jsx("button",{type:"button",onClick:Me,className:"px-3 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",children:"Close"})]}),e.jsx("div",{className:"mt-4 rounded-xl overflow-hidden border border-border/40 bg-black",children:e.jsx("video",{ref:V,playsInline:!0,muted:!0,className:"w-full max-h-[420px] object-contain"})}),De?e.jsx("div",{className:"mt-4 rounded-lg border border-destructive/40 bg-destructive/15 px-4 py-3 text-sm text-destructive-foreground",children:De}):null,e.jsx("div",{className:"mt-5 flex gap-3 justify-end",children:Oe==="photo"?e.jsx("button",{type:"button",onClick:bt,className:"px-5 py-2 bg-primary/80 hover:bg-primary text-primary-foreground rounded-lg border border-primary/30",children:"Capture"}):e.jsx(e.Fragment,{children:Fe?e.jsx("button",{type:"button",onClick:vt,className:"px-5 py-2 bg-danger hover:bg-red-600 text-white rounded-lg border border-danger/30",children:"Stop"}):e.jsx("button",{type:"button",onClick:yt,className:"px-5 py-2 bg-primary/80 hover:bg-primary text-primary-foreground rounded-lg border border-primary/30",children:"Start Recording"})})})]})}):null,F?e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[99999]",children:e.jsxs("div",{className:"glass-panel p-6 w-[92%] max-w-sm text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-foreground",children:"Uploading…"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Please wait while we send your media to Security."})]})}):null]})}export{rr as default};
