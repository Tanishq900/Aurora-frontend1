import{a as f,r as a,u as j,j as e,L as x}from"./index-BWRs-o60.js";import{s as m}from"./sos.service-z5TfIbel.js";import{A as N}from"./AuroraSelect-thE5CfqJ.js";import"./utils-CKXzwFwe.js";import"./clsx-B-dksMZM.js";function C(){const{user:t,logout:g}=f(),[l,d]=a.useState([]),[h,n]=a.useState(!0),[r,b]=a.useState({status:"",limit:100}),i=j(),c=a.useCallback(async()=>{try{n(!0);const s=await m.getSOSEvents({status:r.status||void 0,limit:r.limit});d(s)}catch(s){console.error("Failed to load history:",s)}finally{n(!1)}},[r.limit,r.status]);a.useEffect(()=>{if((t==null?void 0:t.role)!=="security"){i("/dashboard");return}c()},[c,i,t==null?void 0:t.role]);const p=async()=>{var s,u;if(window.confirm("Are you sure you want to clear all SOS history? This action cannot be undone."))try{const o=await m.clearHistory();alert(`History cleared successfully. Deleted ${o.deleted} events.`),d([])}catch(o){alert(`Failed to clear history: ${((u=(s=o.response)==null?void 0:s.data)==null?void 0:u.error)||o.message}`)}},y=s=>s>=50?"text-danger":s>=25?"text-warning":"text-safe";return e.jsxs("div",{className:"min-h-screen bg-black p-6 relative",children:[e.jsx("div",{className:"aurora-bg"}),e.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[e.jsxs("div",{className:"glass-panel border-b border-border/50 px-6 py-4 flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold aurora-text",children:"Alert History"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All SOS events"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(x,{to:"/security",className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"Back to Dashboard"}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"Logout"})]})]}),e.jsx("div",{className:"glass-panel p-4 mb-6",children:e.jsxs("div",{className:"flex gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:e.jsx(N,{value:r.status,onChange:s=>b({...r,status:s}),options:[{value:"",label:"All Status"},{value:"new",label:"New"},{value:"acknowledged",label:"Acknowledged"},{value:"resolved",label:"Resolved"}]})}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-danger hover:bg-red-600 text-white rounded-lg transition-colors font-semibold",children:"Clear History"})]})}),e.jsx("div",{className:"glass-panel p-6",children:h?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):l.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No events found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border/60",children:[e.jsx("th",{className:"pb-3 text-muted-foreground",children:"Date"}),e.jsx("th",{className:"pb-3 text-muted-foreground",children:"Risk Score"}),e.jsx("th",{className:"pb-3 text-muted-foreground",children:"Trigger"}),e.jsx("th",{className:"pb-3 text-muted-foreground",children:"Status"}),e.jsx("th",{className:"pb-3 text-muted-foreground",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"border-b border-border/40 hover:bg-secondary/30",children:[e.jsx("td",{className:"py-3 text-muted-foreground",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:`py-3 font-bold ${y(s.risk_score)}`,children:s.risk_score.toFixed(1)}),e.jsx("td",{className:"py-3 text-muted-foreground",children:s.trigger_type.charAt(0).toUpperCase()+s.trigger_type.slice(1)}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.status==="resolved"?"bg-safe/20 text-safe":s.status==="acknowledged"?"bg-warning/20 text-warning":"bg-danger/20 text-danger"}`,children:s.status})}),e.jsx("td",{className:"py-3",children:e.jsx(x,{to:`/security/alert/${s.id}`,className:"text-aurora-cyan hover:opacity-80 transition-opacity",children:"View"})})]},s.id))})]})})})]})]})}export{C as default};
