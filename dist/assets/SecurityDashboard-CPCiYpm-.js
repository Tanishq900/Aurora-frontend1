import{a as L,r as b,u as F,j as e,L as g,b as E}from"./index-CgkMzMIO.js";import{s as M}from"./sos.service-CposHdQ_.js";import{c as H,A as U}from"./AuroraMap-CVpiY_Wg.js";import{c as p}from"./createLucideIcon-BcP27hZ0.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=p("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=p("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=p("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);function P(){const{user:l,logout:N}=L(),[x,u]=b.useState([]),[v,A]=b.useState(!0),[f,c]=b.useState(null),h=F();b.useEffect(()=>{if((l==null?void 0:l.role)!=="security"){h("/dashboard");return}w();const s=localStorage.getItem("accessToken");if(s){const t=H(s),n=r=>{u(a=>{var j;const o=a.findIndex(B=>B.id===r.id);if(o===-1)return[r,...a];const m={...a[o],...r,email:r.email||a[o].email,attachment_urls:(r==null?void 0:r.attachment_urls)??((j=a[o])==null?void 0:j.attachment_urls)},y=a.slice();return y.splice(o,1),[m,...y]})};return t.on("new_sos_alert",r=>{n(r),k()}),t.on("sos:created",r=>{n(r)}),t.on("sos-updated",r=>{n(r)}),t.on("sos_status_update",r=>{u(a=>a.map(o=>o.id===r.id?{...o,...r,email:r.email||o.email}:o))}),()=>{t.off("new_sos_alert"),t.off("sos:created"),t.off("sos-updated"),t.disconnect()}}},[l,h]);const w=async()=>{try{const s=await M.getSOSEvents({status:"new",limit:50});u(s)}catch(s){console.error("Failed to load alerts:",s)}finally{A(!1)}},k=()=>{const s=E.assetBasePath(),t=[`${s}security-alert.mp3`,`${s}security-alert.wav`,`${s}security-alert.ogg`,`${s}no-test.mp3`],n=r=>{if(r>=t.length){const o=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURAJR6Tg8sBtJAU0h9Hz04IzBh5uwO/jmVEQCUek4PLAbSQFNIbR89OCMwYebsDv45lREAlHpODywG0kBTSG0fPTgjMGHm7A7+OZURAJR6Tg8sBtJAU0htHz04IzBh5uwO/jmVEQCUek4PLAbSQFNIbR89OCMwYebsDv45lREAlHpODywG0kBTQ=");o.volume=.5,o.play().catch(()=>{});return}const a=new Audio(t[r]);a.volume=.6,a.play().catch(()=>{n(r+1)}),a.onerror=()=>n(r+1)};n(0)},_=s=>s>=50?"text-danger":s>=25?"text-warning":"text-safe",C=s=>s>=50?"HIGH":s>=25?"MEDIUM":"LOW",i={fire:{label:"Fire Brigade",description:"Call Fire Brigade for fire-related emergencies.",tel:"101",buttonClass:"bg-danger hover:bg-red-600 text-white border border-danger/50 shadow-[0_14px_40px_rgba(0,0,0,0.55),0_0_40px_rgba(239,68,68,0.25)]",icon:e.jsx(G,{className:"h-4 w-4"})},ambulance:{label:"Ambulance",description:"Call Ambulance for medical emergencies.",tel:"108",buttonClass:"bg-white/90 hover:bg-white text-black border border-white/60 shadow-[0_14px_40px_rgba(0,0,0,0.55)]",icon:e.jsx(R,{className:"h-4 w-4"})},police:{label:"Police",description:"Call Police for immediate security response.",tel:"100",buttonClass:"bg-aurora-blue/85 hover:bg-aurora-blue text-white border border-aurora-blue/40 shadow-[0_14px_40px_rgba(0,0,0,0.55),0_0_40px_rgba(59,130,246,0.2)]",icon:e.jsx(I,{className:"h-4 w-4"})}},d=f?i[f]:null,S=()=>{if(d)try{window.location.href=`tel:${d.tel}`}finally{c(null)}};return e.jsxs("div",{className:"min-h-screen bg-black p-6 relative",children:[e.jsx("div",{className:"aurora-bg"}),e.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[e.jsxs("div",{className:"glass-panel border-b border-border/50 px-6 py-4 flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold aurora-text",children:"Security Command Center"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Welcome, ",(l==null?void 0:l.name)||(l==null?void 0:l.email)]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(g,{to:"/security/analytics",className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"Analytics"}),e.jsx(g,{to:"/security/history",className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"History"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg transition-colors border border-border/50",children:"Logout"})]})]}),e.jsxs("div",{className:"glass-panel p-5 mb-6 border border-border/60",children:[e.jsx("div",{className:"flex items-center justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Emergency Services"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quick-call external responders"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>c("fire"),className:`px-5 py-4 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2 ${i.fire.buttonClass}`,children:[i.fire.icon,i.fire.label]}),e.jsxs("button",{type:"button",onClick:()=>c("ambulance"),className:`px-5 py-4 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2 ${i.ambulance.buttonClass}`,children:[i.ambulance.icon,i.ambulance.label]}),e.jsxs("button",{type:"button",onClick:()=>c("police"),className:`px-5 py-4 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2 ${i.police.buttonClass}`,children:[i.police.icon,i.police.label]})]})]}),e.jsxs("div",{className:"mb-6 map-container p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"Live Map & SOS Locations"}),e.jsx(U,{enableGeolocation:!1,sosMarkers:x.map(s=>{var o,m;const t=(o=s.location)==null?void 0:o.lat,n=(m=s.location)==null?void 0:m.lng,r=typeof t=="number"?t:typeof t=="string"?Number.parseFloat(t):NaN,a=typeof n=="number"?n:typeof n=="string"?Number.parseFloat(n):NaN;return{id:s.id,lat:r,lng:a,riskScore:s.risk_score}}).filter(s=>Number.isFinite(s.lat)&&Number.isFinite(s.lng)),height:"400px"})]}),e.jsxs("div",{className:"glass-panel p-6 border border-border/60",children:[e.jsx("div",{className:"flex items-center justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Live Alerts"})}),v?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading alerts..."}):x.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No active alerts"}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsx(g,{to:`/security/alert/${s.id}`,className:"block bg-black/40 hover:bg-black/55 rounded-lg p-4 transition-colors border border-border/60 shadow-[0_10px_30px_rgba(0,0,0,0.35)]",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`text-2xl font-bold ${_(s.risk_score)}`,children:s.risk_score.toFixed(1)}),e.jsx("span",{className:`px-3 py-1 rounded text-xs font-semibold ${s.risk_score>=50?"bg-danger/20 text-danger":s.risk_score>=25?"bg-warning/20 text-warning":"bg-safe/20 text-safe"}`,children:C(s.risk_score)}),Array.isArray(s.attachments)&&s.attachments.length>0?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-aurora-cyan/15 text-aurora-cyan border border-aurora-cyan/30",children:"MEDIA"}):null,e.jsx("span",{className:"text-muted-foreground text-sm",children:s.trigger_type.charAt(0).toUpperCase()+s.trigger_type.slice(1)})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleString()}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["User: ",s.name||s.email||s.user_id||"Unknown sender"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:`px-3 py-1 rounded text-xs font-semibold ${s.status==="resolved"?"bg-safe/20 text-safe":s.status==="acknowledged"?"bg-warning/20 text-warning":"bg-danger/20 text-danger"}`,children:s.status.toUpperCase()})})]})},s.id))})]})]}),d?e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[99999]",children:e.jsxs("div",{className:"glass-panel p-6 w-[92%] max-w-md border border-border/60",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 pb-3 mb-4 border-b border-border/40",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-foreground",children:"Confirm Call"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:d.label})]}),e.jsx("button",{type:"button",onClick:()=>c(null),className:"px-3 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",children:"Close"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:d.description}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:["Dial: ",e.jsx("span",{className:"text-foreground font-semibold",children:d.tel})]}),e.jsxs("div",{className:"mt-5 flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>c(null),className:"px-5 py-2 bg-secondary/60 hover:bg-secondary/80 text-foreground rounded-lg border border-border/50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:S,className:"px-5 py-2 bg-primary/80 hover:bg-primary text-primary-foreground rounded-lg border border-primary/30",children:"Confirm"})]})]})}):null]})}export{P as default};
